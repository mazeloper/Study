#쓰레드 #프로세스 #운영체제


| 프로그램 | 프로세스 |
| ---- | ---- |
| 어떤 작업을 하기 위해 실행할 수 있는 파일 | 실행되어 작업중인 컴퓨터 프로그램 |
| 파일이 저장 장치에 있지만 메모리에<br>올라가 있지 않은 정적인 상태 | 메모리에 적재되고 CPU 자원을 할당받아 <br>프로그램이 실행되고 있는 상태 |
| 코드 덩어리 | 코드 덩어리 실행한것 |

## 쓰레드
#### 프로세스의 한계
과거에는 프로그램이 실행할 때 프로세스 하나만을 사용했다. 하지만 기술이 발전됨에 따라 프로세스 작업 하나만을 사용해서 프로그램을 실행하기에는 한계가 있었다.

과거에는 파일을 다운받으면 실행 시작부터 종료까지 프로세스 하나만을 사용하기 때문에 다운이 완료될 때 까지 다른 일을 할 수 없었다. 그렇다고 여러개의 프로세스를 생성한다면 결국 그만큼의 메모리를 차지하고 CPU 에서 할당받은 자원이 중복되게 될 것이다. 이를 해결하기 위해 **쓰레드** 라는 것이 탄생했다

#### 개념
스레드란, 하나의 프로세스 내에서 작업을 수행하는데 흐름의 단위 이다.
여러개의 작업이 동시에 이루어진다면 그건 여러개의 쓰레드가 동작한다고 할 수 있으며 이를 **멀티 쓰레드** 라고 부른다.

----
## 프로세스의 자원 구조
프로그램이 실행되면 (프로세스가 생성되면)  아래와 같은 4가지 메모리 영역으로 구성되어 할당 받게 된다.

- 코드 영역 : 프로그래머가 작성한 프로그램 함수들의 코드가 CPU 가 해석 가능한 기계어 형태로 저장되어 있다.
- 데이터 영역 : 코드가 실행되면서 사용하는 전역 변수나 각종 데이터 들이 모여있다. 해당 영역은 3가지 영역으로 세분화되어있다.
	- .data : 전역 변수 또는 static 변수 등 프로그램이 사용하는 데이터를 저장
	- .BSS : 초기값 없는 전역 변수, static 변수가 저장
	- .rodata : const 같은 상수 키워드 선언된 변수나 문자열 상수가 저장
- 스택 영역 : 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간 스택은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다 
- 힙 영역 : 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간이다. 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다.

## 프로세스의 자원 공유
각 프로세스는 메모리에 별도의 주소 공간에서 실행이 된다. 그러므로 프로세스는 다른 프로세스의 있는 변수나 자료구조 등에 접근할 수 없다.

하지만 우리는 프로그램(프로세스)를 실행하고 사용하면서 다른 프로그램에 있는 정보들을 가져오는 경우들이 있었다. 하지만 아래 작성된 3가지 방식으로 다른 프로세스의 있는 정보들을 가져올수 있다
- IPC(Inter-Process Communication) 사용
- LPC(Local Inter-Proccess Communication) 사용
- 별도의 공유 메모리를 만들어서 서로 정보를 주고 받도록 설정

이러한 프로세스 자원 공유는 단순히 CPU 레지스터 교체뿐만 아니라 RAM 과 CPU 사이의 캐시 메모리까지 초기화하기 때문에 **자원 부담이 크다는 단점이 있다.**


----

## 멀티 코어와 스레드

**EX ) 4코어 8 스레드**

#### 코어
명령어를 메모리에서 뽑아 해석하고 실행하는 반도체 유닛
ex) 4코어 => 해당 반도체 유닛이 4개가 있다.

#### 스레드
논리적 코어 갯수, 물리적 코어 하나가 스레드 두 개 이상을 동시에 실행 가능하다는 의미이다.
우리가 알고있는 스레드(소프트웨어) 와 CPU 의 스레드(하드웨어) 와는 조금 다른 개념이다.

=> 4개의 반도체 유닛을 통해 8개의 작업을 동시에 처리할 수 있다는 뜻이다.
해당 기술을 **하이퍼스레딩** 이라고 한다

----

## CPU 의 작업 처리 방식

4코어 8 스레드 CPU 를 장착한 컴퓨터는 여러 수많은 프로그램을 실행시키고 작업들을 처리하는데 어떻게 8개의 물리적인 스레드로 처리가 가능한 것일까?

#### 병렬성 (Parallelism)
병렬성은 직관적으로 명령어를 메모리에서 뽑아 해석하고 실행하는 반도체 유닛인 여러개의 코어에 맞춰 여러개의 프로세스, 스레드를 돌려 병렬로 작업들을 동시 수행하는 것

#### 동시성 (Concurrency)
동시성은 둘 이상의 작업이 동시에 실행되는 것. `병렬성`은 물리적으로 동시에 실행되는 것이라고 하면, `동시성` 은 동시에 실행하는 것처럼 보이게 하는 것.

1개의 코어가 있고 4개의 작업이 있으면, 프로세스를 번갈아 가면서 조금씩 처리함으로서 동시에 진행되고 있는 거처럼 보이게 하는 거다. 아주 조금씩 처리하여 사용자에게는 모두 동시에 진행되고 있는거처럼 보인다.



